<div class="main">
    @if (showTable()) {
        <p-table #dt [columns]="selectedColumns" [value]="estimates()" [lazy]="true" (onLazyLoad)="loadEstimatesLazy($event)"
                 [paginator]="true" [rows]="20" [totalRecords]="totalRecords()" [loading]="loading()">
            <ng-template pTemplate="caption">
                <p-multiSelect [options]="cols" [(ngModel)]="selectedColumns" optionLabel="header"></p-multiSelect>
                @if (userLevel() === 'admin' || userLevel() === 'superadmin') {
                    <p-dropdown [options]="companies" [ngModel]="selectedCompany()" (onChange)="selectedCompany.set($event.value)"></p-dropdown>
                }
            </ng-template>
            <ng-template pTemplate="header" let-columns>
                <tr>@for (col of columns; track col.field) { <th>{{col.header}}</th> }</tr>
                <tr>@for (col of columns; track col.field) {
                    <th>
                        @if (['userEmail', 'materialName'].includes(col.field)) {
                            <input pInputText type="text" (input)="dt.filter($any($event.target).value, col.field, 'contains')">
                        }
                        @if (col.field === 'laminate') {
                            <p-dropdown [options]="booleanOptions" (onChange)="dt.filter($event.value, col.field, 'equals')" styleClass="w-full"></p-dropdown>
                        }
                    </th>
                }</tr>
            </ng-template>
            <ng-template pTemplate="body" let-rowData let-columns="columns">
                <tr>@for (col of columns; track col.field) {
                    <td>{{ col.field === 'price' ? (rowData[col.field] | currency) : displayData(rowData, col.field) }}</td>
                }</tr>
            </ng-template>
        </p-table>
    }
</div>